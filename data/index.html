<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <title>Boat instrument settings</title>
</head>

<body>
    <h1 style="text-align: center;">Boat instrument settings</h1>
    <p style="text-align: center;">On this page you can change the setting of the display.</p>
    <div style="width: fit-content; margin-left: auto; margin-right: auto; margin-top: 50px;">
        <div class="setting_div">
            <span>Speed metrics</span>
            <select name="speed" id="speed">
                <option value="1">Knots</option>
                <option value="0">Kmph</option>

            </select>
        </div>
        <div class="setting_div">
            <span>Full refresh every</span>
            <select name="fullref" id="fullref">
                <option value="15000">15s</option>
                <option value="10000">10s</option>
                <option value="20000">20s</option>
                <option value="25000">25s</option>
                <option value="30000">30s</option>
                <option value="40000">40s</option>
                <option value="50000">50s</option>
                <option value="60000">60s</option>
            </select>
        </div>
        <div class="setting_div">
            <span>Refresh speed every</span>
            <select name="shortref" id="shortref">
                <option value="500">500ms</option>
                <option value="1000">1s</option>
                <option value="2000">2s</option>
                <option value="3000">3s</option>
                <option value="4000">4s</option>
                <option value="5000">5s</option>
            </select>
        </div>
        <div class="setting_div">
            <span>Language</span>
            <select name="lang" id="lang">
                <option value="0">English</option>
                <option value="1">Hungarian</option>

            </select>
        </div>
    </div>
    <p onclick="sendData()" style="margin-left: auto; margin-right: auto; width: fit-content; cursor: pointer;
    padding: 10px; background-color: green; border-radius: 7px; color: white;">Save</p>

    <p onclick="resetData()" style="margin-left: auto; margin-right: auto; width: fit-content; cursor: pointer;
    padding: 10px; background-color: orange; border-radius: 7px; color: white;">Reset</p>
</body>
<style>
    select {
        background-color: white;
        border: 1px solid black;
        border-radius: 3px;
    }

    .setting_div {
        margin-top: 10px;
        font-weight: bold;
    }
</style>
<script>
    async function getData() {
        const url = "/settings";
        //const url = "http://192.168.4.1/settings"
        try {
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`Response status: ${response.status}`);
            }

            const text = await response.text();
            console.log(text)
            //document.getElementById("test").innerHTML = text;
            setCurrent(text.trimEnd())
        } catch (error) {
            console.error(error.message);
        }
    }

    function setCurrent(settings_text) {
        let settings_split = settings_text.split(";")
        settings_split.forEach(element => {
            let settings_element = element.split(":")
            console.log(settings_element)
            switch (settings_element[0]) {
                case "knots": {
                    let html_el = document.getElementById("speed");
                    html_el.value = settings_element[1]
                    break;
                }
                case "full": {
                    let html_el = document.getElementById("fullref");
                    html_el.value = settings_element[1]
                    break;
                }
                case "short": {
                    let html_el = document.getElementById("shortref");
                    html_el.value = settings_element[1]
                    break;
                }
                case "lang": {
                    let html_el = document.getElementById("lang");
                    html_el.value = settings_element[1]
                    break;
                }


                default:
                    break;
            }
        });
    }

    async function sendData() {
        let speed = document.getElementById("speed").value;
        let fullref = document.getElementById("fullref").value;
        let shortref = document.getElementById("shortref").value;
        let lang = document.getElementById("lang").value;
        let url = `/modify?knots=${speed}&full=${fullref}&short=${shortref}&lang=${lang}`
        //let url = `http://192.168.4.1/modify?knots=${speed}&full=${fullref}&short=${shortref}&lang=${lang}`
        console.log(url)
        const response = await fetch(url);
    }

    async function resetData() {
        let url = `/reset`
        //let url = `http://192.168.4.1/reset`
        console.log(url)
        const response = await fetch(url);
    }

    getData();
</script>

</html>